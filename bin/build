#!/bin/bash

set -ex
export NODE_ENV=production
BUILD_DIR=tmp/build

rm -rf $BUILD_DIR out
mkdir -p $BUILD_DIR
./node_modules/.bin/webpack
cp -a html package.json yarn.lock index.js $BUILD_DIR
cd $BUILD_DIR
yarn install
cd -

APP_NAME=$(node -e "process.stdout.write(require('./package.json').name)")
./node_modules/.bin/electron-packager $BUILD_DIR $APP_NAME \
  --asar \
  --overwrite \
  --platform=darwin \
  --arch=x64 \
  --out=./out \
  --no-prune \
  --app-copyright=hokaccha
